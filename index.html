<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grimmy Casino Mini App</title>
  <style>
    :root{
      --bg:#070b10;
      --card:#0c1220;
      --txt:#e7f3ff;
      --muted:#93a9bf;
      --teal:#10f0d7;
      --blue:#00b7ff;
      --danger:#ff4d6d;
      --ok:#39ff88;
      --border:rgba(255,255,255,.09);
      --shadow: 0 16px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(16,240,215,.18), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(0,183,255,.15), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(16,240,215,.10), transparent 60%),
        var(--bg);
      color:var(--txt);
      padding:16px;
    }
    .wrap{max-width:760px;margin:0 auto}
    .hero{
      border:1px solid var(--border);
      border-radius:var(--r);
      padding:16px;
      background:linear-gradient(180deg, rgba(16,240,215,.08), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      display:flex; gap:12px; align-items:center;
    }
    .badge{
      width:46px;height:46px; border-radius:14px;
      display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(16,240,215,.28), rgba(0,183,255,.18));
      border:1px solid rgba(16,240,215,.22);
      font-size:22px;
    }
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin:4px 0 0;color:var(--muted);font-size:13px;line-height:1.35}
    .bar{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .pill{
      flex:1 1 180px;
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background:rgba(10,16,26,.55);
    }
    .pill b{display:block;font-size:12px;color:var(--muted);font-weight:600}
    .pill span{display:block;font-size:18px;margin-top:4px;font-weight:900}
    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:620px){ .grid{grid-template-columns:1fr;} }
    .card{
      border:1px solid var(--border);
      border-radius:var(--r);
      padding:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      box-shadow:var(--shadow);
    }
    .card h2{margin:0 0 8px;font-size:15px}
    .muted{color:var(--muted);font-size:13px;line-height:1.35}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    input{
      width:100%;
      padding:13px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,16,26,.55);
      color:var(--txt);
      outline:none;
      font-size:16px;
    }
    input:focus{border-color:rgba(16,240,215,.45); box-shadow:0 0 0 3px rgba(16,240,215,.12)}
    .btn{
      width:100%;
      padding:13px 14px;
      border-radius:16px;
      border:0;
      cursor:pointer;
      font-size:15px;
      font-weight:900;
      letter-spacing:.2px;
      transition:transform .08s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(1.05)}
    .primary{background:linear-gradient(135deg, var(--teal), var(--blue)); color:#00121a}
    .ghost{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); color:var(--txt)}
    .danger{background:rgba(255,77,109,.14); border:1px solid rgba(255,77,109,.28); color:var(--txt)}
    .ok{color:var(--ok)}
    .bad{color:var(--danger)}
    .divider{height:1px;background:rgba(255,255,255,.10); margin:12px 0}
    .screen{display:none}
    .screen.active{display:block}

    /* Slots */
    .slots{
      display:grid; grid-template-columns: repeat(3, 1fr);
      gap:10px; margin-top:10px;
    }
    .reel{
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      background:rgba(10,16,26,.55);
      height:78px;
      display:grid; place-items:center;
      font-size:34px;
      font-weight:900;
      box-shadow: inset 0 0 0 2px rgba(16,240,215,.05);
    }
    .big{
      font-size:14px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,16,26,.55);
      margin-top:10px;
      white-space:pre-wrap;
      line-height:1.4;
    }

    /* Blackjack */
    .hand{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .cardy{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,16,26,.55);
      min-width:44px;
      text-align:center;
      font-weight:900;
    }
    .controls{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px; margin-top:10px}
    @media (max-width:620px){ .controls{grid-template-columns:1fr} }
  </style>
</head>

<body>
<div class="wrap">
  <div class="hero">
    <div class="badge">üé∞</div>
    <div>
      <h1>Grimmy Casino ‚Äî Interactive Mini App</h1>
      <div class="sub">Games play inside the Mini App. Balance is stored locally (simple mode).</div>
    </div>
  </div>

  <div class="bar">
    <div class="pill"><b>Balance</b><span id="bal">0</span></div>
    <div class="pill"><b>Jackpot</b><span id="jp">0</span></div>
    <div class="pill"><b>Status</b><span id="status">Ready</span></div>
  </div>

  <!-- LOBBY -->
  <div class="grid screen active" id="screen-lobby">
    <div class="card">
      <h2>Lobby</h2>
      <div class="muted">Choose a game. Set your bet inside each game.</div>
      <div class="row">
        <button class="btn primary" onclick="go('slots')">üé∞ Slots</button>
        <button class="btn primary" onclick="go('bj')">üÉè Blackjack</button>
      </div>
      <div class="row">
        <button class="btn ghost" onclick="go('dice','dice')">üé≤ Dice</button>
        <button class="btn ghost" onclick="go('dice','darts')">üéØ Darts</button>
      </div>
      <div class="row">
        <button class="btn ghost" onclick="go('dice','basket')">üèÄ Basketball</button>
        <button class="btn ghost" onclick="go('dice','football')">‚öΩ Football</button>
      </div>
      <div class="row">
        <button class="btn ghost" onclick="go('dice','bowling')">üé≥ Bowling</button>
        <button class="btn danger" onclick="resetAll()">Reset Local Balance</button>
      </div>
    </div>

    <div class="card">
      <h2>Quick Notes</h2>
      <div class="muted">
        ‚Ä¢ This is ‚Äúsimple mode‚Äù: balance is stored on-device (localStorage).<br>
        ‚Ä¢ If you want real anti-cheat + shared balances, you‚Äôll need a backend (I can wire that next).<br>
        ‚Ä¢ Works best when opened inside Telegram.
      </div>
      <div class="divider"></div>
      <button class="btn ghost" onclick="closeApp()">Close</button>
    </div>
  </div>

  <!-- SLOTS -->
  <div class="screen" id="screen-slots">
    <div class="card">
      <h2>üé∞ Slots</h2>
      <div class="muted">Match 3 symbols to win multipliers. Jackpot chance on big hit.</div>

      <div class="row">
        <div style="flex:1">
          <label class="muted">Bet</label>
          <input id="slotsBet" type="number" min="1" placeholder="e.g. 250" />
        </div>
        <div style="flex:1">
          <label class="muted">Quick</label>
          <div class="row" style="margin-top:0">
            <button class="btn ghost" onclick="setBet('slotsBet', 50)">50</button>
            <button class="btn ghost" onclick="setBet('slotsBet', 250)">250</button>
            <button class="btn ghost" onclick="setBet('slotsBet', 1000)">1k</button>
          </div>
        </div>
      </div>

      <div class="slots">
        <div class="reel" id="r1">‚¨õ</div>
        <div class="reel" id="r2">‚¨õ</div>
        <div class="reel" id="r3">‚¨õ</div>
      </div>

      <div class="row">
        <button class="btn primary" id="spinBtn" onclick="spinSlots()">SPIN</button>
        <button class="btn ghost" onclick="back()">Back</button>
      </div>

      <div class="big" id="slotsLog">Place a bet and spin.</div>
    </div>
  </div>

  <!-- BLACKJACK -->
  <div class="screen" id="screen-bj">
    <div class="card">
      <h2>üÉè Blackjack</h2>
      <div class="muted">Goal: beat dealer without busting. Dealer hits to 17.</div>

      <div class="row">
        <div style="flex:1">
          <label class="muted">Bet</label>
          <input id="bjBet" type="number" min="1" placeholder="e.g. 250" />
        </div>
        <div style="flex:1">
          <label class="muted">Quick</label>
          <div class="row" style="margin-top:0">
            <button class="btn ghost" onclick="setBet('bjBet', 50)">50</button>
            <button class="btn ghost" onclick="setBet('bjBet', 250)">250</button>
            <button class="btn ghost" onclick="setBet('bjBet', 1000)">1k</button>
          </div>
        </div>
      </div>

      <div class="divider"></div>
      <div class="muted"><b>Dealer</b> (<span id="dVal">?</span>)</div>
      <div class="hand" id="dealerHand"></div>

      <div class="divider"></div>
      <div class="muted"><b>You</b> (<span id="pVal">0</span>)</div>
      <div class="hand" id="playerHand"></div>

      <div class="controls">
        <button class="btn primary" id="bjDealBtn" onclick="bjStart()">DEAL</button>
        <button class="btn ghost" onclick="bjHit()" id="bjHitBtn" disabled>HIT</button>
        <button class="btn ghost" onclick="bjStand()" id="bjStandBtn" disabled>STAND</button>
        <button class="btn ghost" onclick="bjDouble()" id="bjDoubleBtn" disabled>DOUBLE</button>
        <button class="btn danger" onclick="bjSurrender()" id="bjSurrenderBtn" disabled>SURRENDER</button>
        <button class="btn ghost" onclick="back()">Back</button>
      </div>

      <div class="big" id="bjLog">Tap DEAL to start.</div>
    </div>
  </div>

  <!-- DICE -->
  <div class="screen" id="screen-dice">
    <div class="card">
      <h2 id="diceTitle">üé≤ Dice</h2>
      <div class="muted" id="diceDesc">Roll for a win.</div>

      <div class="row">
        <div style="flex:1">
          <label class="muted">Bet</label>
          <input id="diceBet" type="number" min="1" placeholder="e.g. 250" />
        </div>
        <div style="flex:1">
          <label class="muted">Quick</label>
          <div class="row" style="margin-top:0">
            <button class="btn ghost" onclick="setBet('diceBet', 50)">50</button>
            <button class="btn ghost" onclick="setBet('diceBet', 250)">250</button>
            <button class="btn ghost" onclick="setBet('diceBet', 1000)">1k</button>
          </div>
        </div>
      </div>

      <div class="divider"></div>
      <div class="reel" id="diceFace" style="height:90px;font-size:38px">‚¨õ</div>

      <div class="row">
        <button class="btn primary" id="diceBtn" onclick="playDice()">ROLL</button>
        <button class="btn ghost" onclick="back()">Back</button>
      </div>

      <div class="big" id="diceLog">Place a bet and roll.</div>
    </div>
  </div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  // Telegram UI niceties
  const tg = window.Telegram?.WebApp || null;
  if (tg) { tg.ready(); tg.expand(); }

  // --- Local economy (simple mode)
  const STORE_KEY = "grimmy_casino_state_v1";
  const DEFAULT = { balance: 1000, jackpot: 5000 };

  function loadState(){
    try {
      const s = JSON.parse(localStorage.getItem(STORE_KEY) || "null");
      if (!s || typeof s.balance !== "number" || typeof s.jackpot !== "number") return { ...DEFAULT };
      return s;
    } catch { return { ...DEFAULT }; }
  }
  function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); renderTop(); }
  let state = loadState();

  // --- UI helpers
  function fmt(n){ return Number(n).toLocaleString("en-US"); }
  function setStatus(t){ document.getElementById("status").textContent = t; }
  function renderTop(){
    document.getElementById("bal").textContent = fmt(state.balance);
    document.getElementById("jp").textContent = fmt(state.jackpot);
  }
  renderTop();

  function show(screenId){
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById("screen-"+screenId).classList.add("active");
  }
  function back(){ show("lobby"); setStatus("Ready"); }
  function go(screenId, kind=null){
    currentDiceKind = kind;
    if (screenId === "dice") setupDice(kind);
    show(screenId);
    setStatus("In game");
  }
  function setBet(id, v){ document.getElementById(id).value = v; }
  function closeApp(){ if (tg) tg.close(); else window.close(); }

  function resetAll(){
    state = { ...DEFAULT };
    saveState();
    setStatus("Reset");
    alert("Local balance reset to 1,000 and jackpot to 5,000.");
  }

  // --- Common economy rules (simple)
  const MIN_BET = 10;
  const MAX_BET = 250000;
  const JACKPOT_FEE_BP = 250; // 2.5%

  function takeBet(bet){
    bet = Math.floor(Number(bet || 0));
    if (!Number.isFinite(bet) || bet < MIN_BET) return { ok:false, msg:`Min bet is ${fmt(MIN_BET)}.` };
    if (bet > MAX_BET) return { ok:false, msg:`Max bet is ${fmt(MAX_BET)}.` };
    if (state.balance < bet) return { ok:false, msg:`Not enough balance. You have ${fmt(state.balance)}.` };

    const jpFee = Math.floor(bet * JACKPOT_FEE_BP / 10000);
    state.balance -= bet;
    state.jackpot += jpFee;
    saveState();
    return { ok:true, bet, jpFee, effective: bet - jpFee };
  }

  // ---------------- SLOTS ----------------
  const SYMBOLS = ["üçí","üçã","üçá","üîî","üíé","7Ô∏è‚É£"];
  const PAY = {
    "üçíüçíüçí":5, "üçãüçãüçã":6, "üçáüçáüçá":7, "üîîüîîüîî":10, "üíéüíéüíé":25, "7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£":50
  };
  function pickWeighted(){
    const w = ["üçí","üçí","üçí","üçí","üçã","üçã","üçã","üçá","üçá","üîî","üîî","üíé","7Ô∏è‚É£"];
    return w[Math.floor(Math.random()*w.length)];
  }
  async function spinSlots(){
    const btn = document.getElementById("spinBtn");
    btn.disabled = true;

    const betIn = document.getElementById("slotsBet").value;
    const t = takeBet(betIn);
    if (!t.ok){
      document.getElementById("slotsLog").textContent = "‚ùå " + t.msg;
      btn.disabled = false;
      return;
    }

    document.getElementById("slotsLog").textContent =
      `Bet: ${fmt(t.bet)} | Jackpot Fee: ${fmt(t.jpFee)}\nSpinning...`;

    // animation frames
    for (let i=0;i<10;i++){
      document.getElementById("r1").textContent = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
      document.getElementById("r2").textContent = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
      document.getElementById("r3").textContent = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
      await new Promise(r=>setTimeout(r, 80 + i*15));
    }

    const reels = [pickWeighted(), pickWeighted(), pickWeighted()];
    document.getElementById("r1").textContent = reels[0];
    document.getElementById("r2").textContent = reels[1];
    document.getElementById("r3").textContent = reels[2];

    const key = reels.join("");
    const mult = PAY[key] || 0;

    if (mult > 0){
      let win = t.effective * mult;
      state.balance += win;

      // tiny jackpot chance when winning
      let jpHit = false;
      if (Math.random() < 0.01){
        const jp = state.jackpot;
        state.jackpot = 5000;
        state.balance += jp;
        jpHit = true;
        win += jp;
      }

      saveState();
      document.getElementById("slotsLog").textContent =
        `‚úÖ WIN! ${reels.join(" ")}\nPayout: ${fmt(t.effective*mult)} (x${mult})` +
        (jpHit ? `\nüèÜ JACKPOT HIT! +${fmt(state.jackpot === 5000 ? (win - t.effective*mult) : 0)}` : "");
    } else {
      saveState();
      document.getElementById("slotsLog").textContent =
        `‚ùå No match.\nResult: ${reels.join(" ")}\nLost: ${fmt(t.bet)}`;
    }

    btn.disabled = false;
  }

  // ---------------- BLACKJACK ----------------
  let bj = null;

  function deckNew(){
    const suits = ["‚ô†","‚ô•","‚ô¶","‚ô£"];
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    const d=[];
    for (const s of suits) for (const r of ranks) d.push({r,s});
    for (let i=d.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [d[i],d[j]]=[d[j],d[i]];
    }
    return d;
  }
  function cardStr(c){ return c.r + c.s; }
  function handVal(hand){
    let total=0, aces=0;
    for (const c of hand){
      if (c.r==="A"){ aces++; total+=11; }
      else if (["K","Q","J"].includes(c.r)) total+=10;
      else total+=Number(c.r);
    }
    while (total>21 && aces>0){ total-=10; aces--; }
    return total;
  }
  function isBJ(hand){ return hand.length===2 && handVal(hand)===21; }

  function bjRender(revealDealer=false){
    const d = document.getElementById("dealerHand");
    const p = document.getElementById("playerHand");
    d.innerHTML=""; p.innerHTML="";
    bj.dealer.forEach((c,idx)=>{
      const el=document.createElement("div");
      el.className="cardy";
      el.textContent = (!revealDealer && idx===1) ? "??" : cardStr(c);
      d.appendChild(el);
    });
    bj.player.forEach(c=>{
      const el=document.createElement("div");
      el.className="cardy";
      el.textContent = cardStr(c);
      p.appendChild(el);
    });

    document.getElementById("pVal").textContent = handVal(bj.player);
    document.getElementById("dVal").textContent = revealDealer ? handVal(bj.dealer) : "?";
  }

  function bjSetButtons(active){
    document.getElementById("bjHitBtn").disabled = !active;
    document.getElementById("bjStandBtn").disabled = !active;
    document.getElementById("bjDoubleBtn").disabled = !active;
    document.getElementById("bjSurrenderBtn").disabled = !active;
    document.getElementById("bjDealBtn").disabled = active;
  }

  function bjLog(t){ document.getElementById("bjLog").textContent = t; }

  function bjStart(){
    if (bj && bj.active) return;
    const betIn = document.getElementById("bjBet").value;
    const t = takeBet(betIn);
    if (!t.ok){ bjLog("‚ùå " + t.msg); return; }

    bj = {
      active:true,
      bet: t.bet,
      effective: t.effective,
      jpFee: t.jpFee,
      deck: deckNew(),
      player: [],
      dealer: [],
      doubled: false
    };

    bj.player.push(bj.deck.pop(), bj.deck.pop());
    bj.dealer.push(bj.deck.pop(), bj.deck.pop());

    bjRender(false);
    bjSetButtons(true);

    // immediate blackjack resolution
    const pBJ = isBJ(bj.player), dBJ = isBJ(bj.dealer);
    if (pBJ || dBJ){
      bjFinish();
    } else {
      bjLog(`Dealt. Your move.\nBet: ${fmt(bj.bet)} | Jackpot Fee: ${fmt(bj.jpFee)}`);
    }
  }

  function bjHit(){
    if (!bj?.active) return;
    bj.player.push(bj.deck.pop());
    bjRender(false);
    const pv = handVal(bj.player);
    if (pv > 21){
      bjFinish(true);
    } else {
      bjLog("HIT. Your move.");
    }
  }

  function bjStand(){
    if (!bj?.active) return;
    bjFinish();
  }

  function bjDouble(){
    if (!bj?.active) return;
    if (state.balance < bj.bet){
      bjLog(`‚ùå Not enough balance to double (need ${fmt(bj.bet)}).`);
      return;
    }
    // take additional bet (simple: same jackpot fee rule applies)
    const extra = takeBet(bj.bet);
    if (!extra.ok){ bjLog("‚ùå " + extra.msg); return; }

    bj.bet += extra.bet;
    bj.effective += extra.effective;
    bj.jpFee += extra.jpFee;
    bj.doubled = true;

    bj.player.push(bj.deck.pop());
    bjRender(false);
    bjFinish();
  }

  function bjSurrender(){
    if (!bj?.active) return;
    // refund half of total bet
    const refund = Math.floor(bj.bet / 2);
    state.balance += refund;
    saveState();
    bjRender(true);
    bjLog(`üè≥Ô∏è Surrendered. Refunded: ${fmt(refund)}.`);
    bj.active = false;
    bjSetButtons(false);
  }

  function bjFinish(busted=false){
    // dealer plays
    let pv = handVal(bj.player);
    if (!busted && pv <= 21){
      while (handVal(bj.dealer) < 17){
        bj.dealer.push(bj.deck.pop());
      }
    }
    const dv = handVal(bj.dealer);

    bjRender(true);

    let delta = 0;
    let msg = "";

    if (pv > 21){
      delta = 0;
      msg = `üí• You busted (${pv}). You lose ${fmt(bj.bet)}.`;
    } else if (dv > 21){
      delta = bj.bet * 2; // return bet + win equal to bet
      msg = `üî• Dealer busted (${dv}). You win ${fmt(bj.bet)}!`;
    } else {
      const pBJ = isBJ(bj.player), dBJ = isBJ(bj.dealer);
      if (pBJ && !dBJ){
        const win = Math.floor(bj.bet * 1.5);
        delta = bj.bet + win; // return bet + win
        msg = `‚ú® Blackjack! Win ${fmt(win)} (3:2).`;
      } else if (dBJ && !pBJ){
        delta = 0;
        msg = `üòµ Dealer blackjack. You lose ${fmt(bj.bet)}.`;
      } else if (pv > dv){
        delta = bj.bet * 2;
        msg = `‚úÖ You win! ${pv} vs ${dv} (+${fmt(bj.bet)}).`;
      } else if (pv < dv){
        delta = 0;
        msg = `‚ùå You lose. ${pv} vs ${dv} (-${fmt(bj.bet)}).`;
      } else {
        delta = bj.bet; // push returns bet
        msg = `ü§ù Push! ${pv} vs ${dv}. Bet returned.`;
      }
    }

    // Apply payout
    if (delta > 0){
      state.balance += delta;
      saveState();
    } else {
      saveState();
    }

    bjLog(`${msg}\nBet: ${fmt(bj.bet)} | Jackpot Fee: ${fmt(bj.jpFee)}`);
    bj.active = false;
    bjSetButtons(false);
  }

  // ---------------- DICE ----------------
  let currentDiceKind = "dice";
  const DICE = {
    dice:    { title:"üé≤ Dice", desc:"Win on 6 (x3)", win:[6], mult:3, faces:["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"] },
    darts:   { title:"üéØ Darts", desc:"Bullseye-ish win on 6 (x3)", win:[6], mult:3, faces:["1Ô∏è‚É£","2Ô∏è‚É£","3Ô∏è‚É£","4Ô∏è‚É£","5Ô∏è‚É£","üéØ"] },
    basket:  { title:"üèÄ Basketball", desc:"Win on 5 (x2)", win:[5], mult:2, faces:["‚ùå","‚ùå","‚ùå","‚ùå","üèÄ","üèÄ"] },
    football:{ title:"‚öΩ Football", desc:"Win on 5 (x2)", win:[5], mult:2, faces:["‚ùå","‚ùå","‚ùå","‚ùå","‚öΩ","‚öΩ"] },
    bowling: { title:"üé≥ Bowling", desc:"Strike win on 6 (x3)", win:[6], mult:3, faces:["1Ô∏è‚É£","2Ô∏è‚É£","3Ô∏è‚É£","4Ô∏è‚É£","5Ô∏è‚É£","üé≥"] },
  };

  function setupDice(kind){
    const g = DICE[kind] || DICE.dice;
    document.getElementById("diceTitle").textContent = g.title;
    document.getElementById("diceDesc").textContent = g.desc;
    document.getElementById("diceFace").textContent = "‚¨õ";
    document.getElementById("diceLog").textContent = "Place a bet and roll.";
  }

  async function playDice(){
    const g = DICE[currentDiceKind] || DICE.dice;
    const btn = document.getElementById("diceBtn");
    btn.disabled = true;

    const betIn = document.getElementById("diceBet").value;
    const t = takeBet(betIn);
    if (!t.ok){
      document.getElementById("diceLog").textContent = "‚ùå " + t.msg;
      btn.disabled = false;
      return;
    }

    document.getElementById("diceLog").textContent =
      `Bet: ${fmt(t.bet)} | Jackpot Fee: ${fmt(t.jpFee)}\nRolling...`;

    // animation
    for (let i=0;i<10;i++){
      document.getElementById("diceFace").textContent = g.faces[Math.floor(Math.random()*g.faces.length)];
      await new Promise(r=>setTimeout(r, 70 + i*10));
    }

    const value = 1 + Math.floor(Math.random()*6);
    document.getElementById("diceFace").textContent = g.faces[value-1] || "üé≤";

    if (g.win.includes(value)){
      const win = t.effective * g.mult;
      state.balance += (t.bet + win); // return bet + profit (simple display)
      // NOTE: we already subtracted bet in takeBet(), so add back bet + win
      saveState();
      document.getElementById("diceLog").textContent =
        `‚úÖ WIN! Rolled ${value}\nPayout: ${fmt(win)} (x${g.mult})`;
    } else {
      saveState();
      document.getElementById("diceLog").textContent =
        `‚ùå Lost. Rolled ${value}\nLost: ${fmt(t.bet)}`;
    }

    btn.disabled = false;
  }

  // init dice screen defaults
  setupDice("dice");
</script>
</body>
</html>
